@inject ISpaSectionService SpaSections
@inject IOptions<AppCustomizationOptions> AppOptions
@inject IAppDictionaryService AppDictionary

<RadzenPanelMenu class="app-nav-menu" DisplayStyle="@MenuItemDisplayStyle.IconAndText" Multiple="false">
    <RadzenPanelMenuItem Text="@AppOptions.Value.Navigation.Home" Icon="home" Path="@HomePath" />
    @if (IsSpaEnabled && SpaSections.Sections.Count > 0)
    {
        <RadzenPanelMenuItem Text="@AppOptions.Value.Navigation.Application" Icon="apps" Expanded="true">
            @foreach (var item in SpaSections.Sections)
            {
                <RadzenPanelMenuItem Text="@item.NavLabel" Icon="@GetSectionIcon(item.Section)" Path="@GetSectionPath(item)" />
            }
        </RadzenPanelMenuItem>
    }
    <RadzenPanelMenuItem Text="Data" Icon="table_chart" Expanded="true">
        @foreach (var entity in AppDictionary.AppDefinition.DataModel.Entities)
        {
            var path = string.IsNullOrWhiteSpace(entity.Schema)
                ? $"entity/{entity.Name}"
                : $"entity/{entity.Schema}/{entity.Name}";
            var label = string.IsNullOrWhiteSpace(entity.Schema)
                ? entity.Name
                : $"{entity.Name} ({entity.Schema})";
            <RadzenPanelMenuItem Text="@label" Icon="data_object" Path="@path" />
        }
    </RadzenPanelMenuItem>
</RadzenPanelMenu>

@code {
    private bool IsSpaEnabled => AppOptions.Value.EnableSpaExample;
    private string HomePath => IsSpaEnabled ? "/" : GetDefaultEntityPath();

    private static string GetSectionIcon(SpaSection section)
    {
        return section switch
        {
            SpaSection.Dashboard => "dashboard",
            SpaSection.Settings => "settings",
            SpaSection.Entity => "table_chart",
            _ => "apps"
        };
    }

    private string GetSectionPath(SpaSectionInfo section)
    {
        return SpaSections.DefaultSection != null && section == SpaSections.DefaultSection
            ? "app"
            : $"app/{section.RouteSegment}";
    }

    private string GetDefaultEntityPath()
    {
        var entity = AppDictionary.AppDefinition.DataModel.Entities.FirstOrDefault();
        if (entity == null)
        {
            return "/";
        }
        return string.IsNullOrWhiteSpace(entity.Schema)
            ? $"entity/{entity.Name}"
            : $"entity/{entity.Schema}/{entity.Name}";
    }
}
