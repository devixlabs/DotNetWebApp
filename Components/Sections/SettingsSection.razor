<RadzenStack Gap="24px" class="settings-section">
    <RadzenCard class="settings-card">
        <RadzenText Text="Appearance" TextStyle="TextStyle.Subtitle2" class="settings-title" />
        <RadzenStack Gap="12px">
            <RadzenStack Orientation="@Orientation.Horizontal" AlignItems="@AlignItems.Center" Gap="12px" class="settings-row">
                <RadzenLabel Text="Theme" />
                <RadzenDropDown Data="@themeOptions" TextProperty="Text" ValueProperty="Value"
                                @bind-Value="selectedTheme" TValue="string" Change="@OnThemeChange" Style="width: 160px;" />
            </RadzenStack>
            <RadzenStack Orientation="@Orientation.Horizontal" AlignItems="@AlignItems.Center" Gap="12px" class="settings-row">
                <RadzenCheckBox @bind-Value="showNotifications" TValue="bool" />
                <RadzenText Text="Show notifications" />
            </RadzenStack>
        </RadzenStack>
    </RadzenCard>

    <RadzenCard class="settings-card">
        <RadzenText Text="Application" TextStyle="TextStyle.Subtitle2" class="settings-title" />
        <RadzenStack Gap="12px">
            <RadzenStack Orientation="@Orientation.Horizontal" AlignItems="@AlignItems.Center" Gap="12px" class="settings-row">
                <RadzenLabel Text="Items per page" />
                <RadzenNumeric @bind-Value="itemsPerPage" TValue="int" Min="5" Max="100" Style="width: 120px;" />
            </RadzenStack>
            <RadzenStack Orientation="@Orientation.Horizontal" AlignItems="@AlignItems.Center" Gap="12px" class="settings-row">
                <RadzenCheckBox @bind-Value="autoSave" TValue="bool" />
                <RadzenText Text="Auto-save changes" />
            </RadzenStack>
            <RadzenStack Orientation="@Orientation.Horizontal" AlignItems="@AlignItems.Center" Gap="12px" class="settings-row">
                <RadzenCheckBox @bind-Value="enableDebugMode" TValue="bool" />
                <RadzenText Text="Enable debug mode" />
            </RadzenStack>
        </RadzenStack>
    </RadzenCard>

    <RadzenCard class="settings-card">
        <RadzenText Text="Security" TextStyle="TextStyle.Subtitle2" class="settings-title" />
        <RadzenStack Gap="12px">
            <RadzenButton Text="Change Password" Icon="key" ButtonStyle="ButtonStyle.Light" Click="ChangePassword" />
            <RadzenStack Orientation="@Orientation.Horizontal" AlignItems="@AlignItems.Center" Gap="12px" class="settings-row">
                <RadzenCheckBox @bind-Value="twoFactorAuth" TValue="bool" />
                <RadzenText Text="Two-factor authentication" />
            </RadzenStack>
        </RadzenStack>
    </RadzenCard>

    <RadzenCard class="settings-card">
        <RadzenText Text="Data" TextStyle="TextStyle.Subtitle2" class="settings-title" />
        <RadzenStack Gap="12px">
            <RadzenButton Text="Export Data" Icon="file_download" ButtonStyle="ButtonStyle.Primary" Click="ExportData" />
            <RadzenButton Text="Clear Cache" Icon="delete" ButtonStyle="ButtonStyle.Warning" Click="ClearCache" />
        </RadzenStack>
    </RadzenCard>

    <RadzenStack Orientation="@Orientation.Horizontal" Gap="12px" class="settings-footer">
        <RadzenButton Text="@(isSaving ? "Saving..." : "Save Settings")" Icon="save" ButtonStyle="ButtonStyle.Success"
                      Disabled="@isSaving" Click="SaveSettings" />
        <RadzenButton Text="Reset to Defaults" Icon="refresh" ButtonStyle="ButtonStyle.Light" Click="ResetSettings" />
    </RadzenStack>

    @if (showSaveMessage)
    {
        <RadzenAlert Severity="AlertSeverity.Success" class="save-message">
            Settings saved successfully.
        </RadzenAlert>
    }
</RadzenStack>

<style>
    .settings-section {
        max-width: 820px;
    }

    .settings-card {
        padding: 18px;
    }

    .settings-title {
        margin-bottom: 12px;
        display: block;
    }

    .settings-row {
        min-height: 36px;
    }

    .settings-footer {
        padding-top: 8px;
    }

    .save-message {
        margin-top: 12px;
        animation: slideIn 0.3s ease-out;
    }
</style>

@code {
    private string selectedTheme = "light";
    private bool showNotifications = true;
    private int itemsPerPage = 20;
    private bool autoSave = false;
    private bool enableDebugMode = false;
    private bool twoFactorAuth = false;
    private bool isSaving = false;
    private bool showSaveMessage = false;
    private IEnumerable<ThemeOption> themeOptions = new[]
    {
        new ThemeOption("Light", "light"),
        new ThemeOption("Dark", "dark"),
        new ThemeOption("Auto", "auto")
    };

    protected override async Task OnInitializedAsync()
    {
        // Load settings from local storage or API
        await LoadSettings();
    }

    private async Task LoadSettings()
    {
        // In a real app, load from localStorage or API
        await Task.Delay(100);
    }

    private async Task OnThemeChange(object value)
    {
        selectedTheme = value?.ToString() ?? "light";
        await Task.Delay(100); // Simulate applying theme
    }

    private async Task ChangePassword()
    {
        // In a real app, open password change modal
        await Task.Delay(100);
        Console.WriteLine("Change password clicked");
    }

    private async Task ExportData()
    {
        // In a real app, trigger data export
        await Task.Delay(100);
        Console.WriteLine("Export data clicked");
    }

    private async Task ClearCache()
    {
        // In a real app, clear application cache
        await Task.Delay(100);
        Console.WriteLine("Clear cache clicked");
    }

    private async Task SaveSettings()
    {
        isSaving = true;
        StateHasChanged();

        try
        {
            // Simulate API call to save settings
            await Task.Delay(1000);
            
            // In a real app, save to API or localStorage
            // await SettingsService.SaveAsync(new Settings { ... });
            
            showSaveMessage = true;
            StateHasChanged();
            
            // Hide message after 3 seconds
            await Task.Delay(3000);
            showSaveMessage = false;
            StateHasChanged();
        }
        finally
        {
            isSaving = false;
            StateHasChanged();
        }
    }

    private async Task ResetSettings()
    {
        selectedTheme = "light";
        showNotifications = true;
        itemsPerPage = 20;
        autoSave = false;
        enableDebugMode = false;
        twoFactorAuth = false;
        
        await Task.Delay(100);
        StateHasChanged();
    }

    private record ThemeOption(string Text, string Value);
}
