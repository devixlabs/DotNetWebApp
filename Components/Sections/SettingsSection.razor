<RadzenStack Gap="24px">
    <RadzenCard>
        <RadzenText Text="Appearance" TextStyle="TextStyle.Subtitle2" />
        <RadzenStack Gap="12px">
            <RadzenStack Orientation="@Orientation.Horizontal" AlignItems="@AlignItems.Center" Gap="12px">
                <RadzenLabel Text="Theme" />
                <RadzenDropDown Data="@themeOptions" TextProperty="Text" ValueProperty="Value"
                                @bind-Value="selectedTheme" TValue="string" Change="@OnThemeChange" Style="width: 160px;" />
            </RadzenStack>
            <RadzenStack Orientation="@Orientation.Horizontal" AlignItems="@AlignItems.Center" Gap="12px">
                <RadzenCheckBox @bind-Value="showNotifications" TValue="bool" />
                <RadzenText Text="Show notifications" />
            </RadzenStack>
        </RadzenStack>
    </RadzenCard>

    <RadzenCard>
        <RadzenText Text="Application" TextStyle="TextStyle.Subtitle2" />
        <RadzenStack Gap="12px">
            <RadzenStack Orientation="@Orientation.Horizontal" AlignItems="@AlignItems.Center" Gap="12px">
                <RadzenLabel Text="Items per page" />
                <RadzenNumeric @bind-Value="itemsPerPage" TValue="int" Min="5" Max="100" Style="width: 120px;" />
            </RadzenStack>
            <RadzenStack Orientation="@Orientation.Horizontal" AlignItems="@AlignItems.Center" Gap="12px">
                <RadzenCheckBox @bind-Value="autoSave" TValue="bool" />
                <RadzenText Text="Auto-save changes" />
            </RadzenStack>
            <RadzenStack Orientation="@Orientation.Horizontal" AlignItems="@AlignItems.Center" Gap="12px">
                <RadzenCheckBox @bind-Value="enableDebugMode" TValue="bool" />
                <RadzenText Text="Enable debug mode" />
            </RadzenStack>
        </RadzenStack>
    </RadzenCard>

    <RadzenCard>
        <RadzenText Text="Security" TextStyle="TextStyle.Subtitle2" />
        <RadzenStack Gap="12px">
            <RadzenButton Text="Change Password" Icon="key" ButtonStyle="ButtonStyle.Light" Click="ChangePassword" />
            <RadzenStack Orientation="@Orientation.Horizontal" AlignItems="@AlignItems.Center" Gap="12px">
                <RadzenCheckBox @bind-Value="twoFactorAuth" TValue="bool" />
                <RadzenText Text="Two-factor authentication" />
            </RadzenStack>
        </RadzenStack>
    </RadzenCard>

    <RadzenCard>
        <RadzenText Text="Data" TextStyle="TextStyle.Subtitle2" />
        <RadzenStack Gap="12px">
            <RadzenButton Text="Export Data" Icon="file_download" ButtonStyle="ButtonStyle.Primary" Click="ExportData" />
            <RadzenButton Text="Clear Cache" Icon="delete" ButtonStyle="ButtonStyle.Warning" Click="ClearCache" />
        </RadzenStack>
    </RadzenCard>

    <RadzenStack Orientation="@Orientation.Horizontal" Gap="12px">
        <RadzenButton Text="@(IsSaving ? "Saving..." : "Save Settings")" Icon="save" ButtonStyle="ButtonStyle.Success"
                      Disabled="@IsSaving" Click="SaveSettings" />
        <RadzenButton Text="Reset to Defaults" Icon="refresh" ButtonStyle="ButtonStyle.Light" Click="ResetSettings" />
    </RadzenStack>

    @if (showSaveMessage)
    {
        <RadzenAlert Severity="AlertSeverity.Success">
            Settings saved successfully.
        </RadzenAlert>
    }
</RadzenStack>

@code {
    private string selectedTheme = "light";
    private bool showNotifications = true;
    private int itemsPerPage = 20;
    private bool autoSave = false;
    private bool enableDebugMode = false;
    private bool twoFactorAuth = false;
    private AsyncUiState? savingState;
    private bool showSaveMessage = false;
    private IEnumerable<ThemeOption> themeOptions = new[]
    {
        new ThemeOption("Light", "light"),
        new ThemeOption("Dark", "dark"),
        new ThemeOption("Auto", "auto")
    };

    protected override async Task OnInitializedAsync()
    {
        savingState = new AsyncUiState(() => InvokeAsync(StateHasChanged));
        // Load settings from local storage or API
        await LoadSettings();
    }

    private bool IsSaving => savingState?.IsBusy == true;

    private async Task LoadSettings()
    {
        // In a real app, load from localStorage or API
        await Task.Delay(100);
    }

    private async Task OnThemeChange(object value)
    {
        selectedTheme = value?.ToString() ?? "light";
        await Task.Delay(100); // Simulate applying theme
    }

    private async Task ChangePassword()
    {
        // In a real app, open password change modal
        await Task.Delay(100);
        Console.WriteLine("Change password clicked");
    }

    private async Task ExportData()
    {
        // In a real app, trigger data export
        await Task.Delay(100);
        Console.WriteLine("Export data clicked");
    }

    private async Task ClearCache()
    {
        // In a real app, clear application cache
        await Task.Delay(100);
        Console.WriteLine("Clear cache clicked");
    }

    private async Task SaveSettings()
    {
        if (savingState is null)
        {
            return;
        }

        await savingState.RunAsync(async () =>
        {
            // Simulate API call to save settings
            await Task.Delay(1000);

            // In a real app, save to API or localStorage
            // await SettingsService.SaveAsync(new Settings { ... });

            showSaveMessage = true;
            await InvokeAsync(StateHasChanged);

            // Hide message after 3 seconds
            await Task.Delay(3000);
            showSaveMessage = false;
            await InvokeAsync(StateHasChanged);
        });
    }

    private async Task ResetSettings()
    {
        selectedTheme = "light";
        showNotifications = true;
        itemsPerPage = 20;
        autoSave = false;
        enableDebugMode = false;
        twoFactorAuth = false;
        
        await Task.Delay(100);
        await InvokeAsync(StateHasChanged);
    }

    private record ThemeOption(string Text, string Value);
}
