<RadzenStack Gap="20px">
    <RadzenRow Gap="20px">
        @* Dynamic entity count cards *@
        @foreach (var entityMeta in EntityMetadataService.Entities)
        {
            var count = summary.EntityCounts.GetValueOrDefault(entityMeta.Definition.Name, 0);
            var displayName = entityMeta.Definition.Name;

            <RadzenColumn Size="12" Medium="6" Large="3">
                <RadzenCard>
                    <RadzenStack Gap="8px">
                        <RadzenText Text="@displayName" TextStyle="TextStyle.Subtitle2" />
                        @if (isLoading)
                        {
                            <RadzenText Text="Loading..." TextStyle="TextStyle.H5" />
                        }
                        else
                        {
                            <RadzenText Text="@count.ToString()" TextStyle="TextStyle.H4" />
                        }
                    </RadzenStack>
                </RadzenCard>
            </RadzenColumn>
        }

        <RadzenColumn Size="12" Medium="6" Large="3">
            <RadzenCard>
                <RadzenStack Gap="8px">
                    <RadzenText Text="Revenue" TextStyle="TextStyle.Subtitle2" />
                    <RadzenText Text="@($"${summary.Revenue:N2}")" TextStyle="TextStyle.H4" />
                </RadzenStack>
            </RadzenCard>
        </RadzenColumn>

        <RadzenColumn Size="12" Medium="6" Large="3">
            <RadzenCard>
                <RadzenStack Gap="8px">
                    <RadzenText Text="Active Users" TextStyle="TextStyle.Subtitle2" />
                    <RadzenText Text="@summary.ActiveUsers.ToString()" TextStyle="TextStyle.H4" />
                </RadzenStack>
            </RadzenCard>
        </RadzenColumn>

        <RadzenColumn Size="12" Medium="6" Large="3">
            <RadzenCard>
                <RadzenStack Gap="8px">
                    <RadzenText Text="Growth" TextStyle="TextStyle.Subtitle2" />
                    <RadzenText Text="@($"+{summary.GrowthPercent}%")" TextStyle="TextStyle.H4" />
                </RadzenStack>
            </RadzenCard>
        </RadzenColumn>
    </RadzenRow>

    <RadzenCard>
        <RadzenStack Gap="12px">
            <RadzenText Text="Recent Activity" TextStyle="TextStyle.Subtitle2" />
            <RadzenStack Gap="8px">
                @foreach (var activity in summary.RecentActivities)
                {
                    <RadzenStack Orientation="@Orientation.Horizontal" JustifyContent="@JustifyContent.SpaceBetween" AlignItems="@AlignItems.Center">
                        <RadzenText Text="@activity.When" TextStyle="TextStyle.Caption" />
                        <RadzenText Text="@activity.Description" />
                    </RadzenStack>
                }
            </RadzenStack>
        </RadzenStack>
    </RadzenCard>
</RadzenStack>

@inject IDashboardService DashboardService
@inject IEntityMetadataService EntityMetadataService

@code {
    private DashboardSummary summary = new();
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            summary = await DashboardService.GetSummaryAsync();
        }
        finally
        {
            isLoading = false;
        }
    }
}
